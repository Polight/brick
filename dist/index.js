function t(t,e,r,n,i,o,s){for(var u=i,l=-1,a=o-i+1;r<=n;){if(s(t[r],e[u])){if(l<0&&(l=r),++u>o)return l}else{if(r+a>n)return-1;l=-1,u=i}r++}return-1}function e(t){for(var e=0;e<t.length;e++){var n=t[e];if(Array.isArray(n))return r(t,t.slice(0,e),e)}return t}function r(t,e,n){for(var i=n;i<t.length;i++){var o=t[i];Array.isArray(o)?r(o,e,0):e.push(o)}return e}function n(t,e,r,n=0,o=t.length-1,s=0,u=e.length-1){var l=function(t,e,r,n=0,i=t.length-1,o=0,s=e.length-1){var u,l,a,d,f,h,c,v=i-n+1,p=s-o+1,y=v+p,m=[];t:for(u=0;u<=y;u++){if(u>50)return;for(c=u-1,f=u>0?m[u-1]:[0,0],h=m[u]=[],l=-u;l<=u;l+=2){for(d=l===-u||l!==u&&f[c+l-1]<f[c+l+1]?f[c+l+1]:f[c+l-1]+1,a=d-l;d<p&&a<v&&r(e[o+d],t[n+a]);)d++,a++;if(d===p&&a===v)break t;h[u+l]=d}}var g,b=Array(u/2+y/2),_={},w=b.length-1;for(u=m.length-1;u>=0;u--){for(;d>0&&a>0&&r(e[o+d-1],t[n+a-1]);)b[w--]=2,d--,a--;if(!u)break;c=u-1,f=u?m[u-1]:[0,0],(l=d-a)===-u||l!==u&&f[c+l-1]<f[c+l+1]?(a--,b[w--]=4):(d--,b[w--]=8,null!=(g=e[o+d]).key&&(_[g.key]=o+d))}return{diff:b,deleteMap:_}}(t,e,r,n,o,s,u);return null!=l?l:function(t,e,r,n,o,s){var u,l,a,d,f,h={},c=[],v=0,p=n-r+1,y=s-o+1,m=Math.min(p,y),g=Array(m+1);g[0]=-1;for(var b=1;b<g.length;b++)g[b]=s+1;var _=Array(m);for(b=o;b<=s;b++)l=e[b],null!=(f=l.key)?h[f]=b:c.push(b);for(b=r;b<=n;b++)u=t[b],null!=(d=null==u.key?c[v++]:h[u.key])&&(a=i(g,d))>=0&&(g[a]=d,_[a]={newi:b,oldi:d,prev:_[a-1]});a=g.length-1;for(;g[a]>s;)a--;var w=_[a],k=Array(y+p-a),S=n,A=s,C=k.length-1;for(;w;){const{newi:t,oldi:e}=w;for(;S>t;)k[C--]=4,S--;for(;A>e;)k[C--]=8,A--;k[C--]=2,S--,A--,w=w.prev}for(;S>=r;)k[C--]=4,S--;for(;A>=o;)k[C--]=8,A--;return{diff:k,deleteMap:h}}(t,e,n,o,s,u)}function i(t,e){for(var r=1,n=t.length-1;r<=n;){var i=Math.ceil((r+n)/2);e<t[i]?n=i-1:r=i+1}return r}const o={selected:!0,value:!0,checked:!0,innerHTML:!0},s="http://www.w3.org/1999/xlink",u={show:s,actuate:s,href:s},l={isSvg:!1};function a(t,e=l){if(S(t))return document.createComment("NULL");if(A(t))return document.createTextNode(String(t));if(C(t)){var r,n,{type:i,props:o,children:s}=t;return"svg"!==i||e.isSvg||(e=Object.assign({},e,{isSVG:!0})),n=v(r=e.isSVG?document.createElementNS("http://www.w3.org/2000/svg",i):document.createElement(i),o,void 0,e.isSVG),h(r,s,0,s.length-1,null,e),null!=n&&c(r,o,void 0,n),r}if(N(t))return t._state={},t.type.mount(t.props,t._state,e);if(void 0===t)throw new Error("mount: vnode is undefined!");throw new Error("mount: Invalid Vnode!")}function d(e,r,i,o=l){if(r===e)return i;if(S(e)&&S(r))return i;if(A(e)&&A(r))return i.nodeValue=String(e),i;if(C(e)&&C(r)&&e.type===r.type){"svg"!==e.type||o.isSvg||(o=Object.assign({},o,{isSVG:!0}));var s=v(i,e.props,r.props,o.isSVG);return function(e,r,i,o){if(r===i)return;var s,u,l,c=0,v=r.length-1,p=0,b=i.length-1,_=Array.from(e.childNodes);for(;c<=v&&p<=b;)if(s=r[c],u=i[p],g(s,u))m(s,u,e,_,p,o),c++,p++;else{if(u=i[b],!g(s=r[v]))break;m(s,u,e,_,b,o),b--,v--}if(c>v&&p>b)return;if(c<=v&&p>b)return void h(e,r,c,v,_[p],o);if(p<=b&&c>v)return void y(e,_,i,p,b);var w=b-p+1,k=v-c+1,S=-1;if(w<k){if((S=t(r,i,c,v,p,b,g))>=0){h(e,r,c,S-1,_[p],o);var A=S+w;for(c=S;c<A;)m(r[c],i[p],e,_,p,o),c++,p++;return b++,void h(e,r,c,v,_[b],o)}}else if(w>k&&(S=t(i,r,p,b,c,v,g))>=0){for(y(e,_,i,p,S-1),A=S+k,p=S;p<A;)m(r[c],i[p],e,_,b,o),c++,p++;return void y(e,_,i,p,b)}if(p===b)return l=_[p],h(e,r,c,v,_[p],o),e.removeChild(l),void f(i[p],l,o);if(c===v)return e.insertBefore(a(r[c],o),_[p]),void y(e,_,i,p,b);var C=n(r,i,g,c,v,p,b);!function(t,e,{diff:r,deleteMap:n},i,o,s,u,l){for(var h,c,v,p,y=0,g=s,b=u;y<r.length;y++){const s=r[y];2===s?(m(i[g],o[b],t,e,b,l),g++,b++):4===s?(h=i[g],null!=(p=null!=h.key?n[h.key]:null)?(v=d(h,o[p],e[p],l),o[p]=void 0):v=a(h,l),t.insertBefore(v,e[b]),g++):8===s&&b++}for(y=0,b=u;y<r.length;y++){const n=r[y];2===n?b++:8===n&&(c=o[b],v=e[b],void 0!==c&&(t.removeChild(v),f(c,v,l)),b++)}}(e,_,C,r,i,c,p,o)}(i,e.children,r.children,o),null!=s&&c(i,e.props,r.props,s),i}return N(e)&&N(r)&&e.type===r.type?(e._state=r._state,e.type.patch(e.props,r.props,e._state,i,o)):a(e,o)}function f(t,e,r){if(!S(t)&&!A(t))if(C(t))for(var n=0;n<t.children.length;n++)f(t.children[n],e.childNodes[n],r);else N(t)&&t.type.unmount(t._state,e,r)}function h(t,e,r=0,n=e.length-1,i,o){for(;r<=n;){var s=e[r++];t.insertBefore(a(s,o),i)}}function c(t,e,r,n){for(var i,o=0;o<n.length;o++){i=n[o];var s=r&&r[i],u=e[i];s!==u&&(t[i]=u)}}function v(t,e,r,n){var i=[];for(var s in e)if(s.startsWith("on")||o.hasOwnProperty(s))i.push(s);else{var u=null!=r?r[s]:void 0,l=e[s];u!==l&&p(t,s,l,n)}for(s in r)s in e||t.removeAttribute(s);if(i.length>0)return i}function p(t,e,r,n){if(!0===r)t.setAttribute(e,"");else if(!1===r)t.removeAttribute(e);else{var i=n?u[e]:void 0;void 0!==i?t.setAttributeNS(i,e,r):t.setAttribute(e,r)}}function y(t,e,r,n=0,i=r.length-1){var o;for(e.length===i-n+1&&(t.textContent="",o=!0);n<=i;){var s=r[n],u=e[n];o||t.removeChild(u),n++,f(s,u)}}function m(t,e,r,n,i,o){var s=n[i],u=d(t,e,s,o);return u!=s&&(n[i]=u,r.replaceChild(u,s),f(e,s,o)),u}function g(t,e){return(null!=t&&null!=t.key?t.key:null)===(null!=e&&null!=e.key?e.key:null)}function b(t,e,r,n){if(r!==n)return!0;for(var i in t)if(t[i]!==e[i])return!0;return!1}const _=Symbol("@petit-dom/component");function w(t){var e=t[_];return null==e&&(e=t[_]=function({render:t,shouldUpdate:e=b}){return{mount(e,r,n){var i=t(e);return r.vnode=i,a(i,n)},patch(r,n,i,o,s){if(!e(r,n))return o;var u=t(r),l=i.vnode;return i.vnode=u,d(u,l,o,s)},unmount(t,e,r){t.wasUnmounted=!0,f(t.vnode,e,r)}}}({render:t,shouldUpdate:t.shouldUpdate})),e}const k={},S=t=>null===t,A=t=>"string"==typeof t||"number"==typeof t,C=t=>null!=t&&128===t.vtype,N=t=>null!=t&&256===t.vtype;function O(t,r=k,...n){const i=null!=r?r.key:null;if("string"==typeof t)return{vtype:128,type:t,key:i,props:r,children:e(n)};if(null!=(o=t)&&null!=o.mount&&null!=o.patch&&null!=o.unmount)return{vtype:256,type:t,key:i,props:Object.assign({},r,{children:n}),_state:null};if("function"==typeof t)return{vtype:256,type:w(t),key:i,props:Object.assign({},r,{children:n}),_state:null};var o;throw new Error("h: Invalid type!")}function M(t,e){var r,n=e.$$petitDomState$$;null==n?(r=a(t),e.appendChild(r)):(r=d(t,n.vnode,n.domNode))!==n.domNode&&(e.replaceChild(r,n.domNode),f(n.vnode,n.domNode)),e.$$petitDomState$$={vnode:t,domNode:r}}class j extends HTMLElement{constructor(){var t;super(),this.useShadowDOM=!0,this.__state=(t=this.__update.bind(this),new Proxy({},{set(e,r,n){const i=Reflect.set(e,r,n);return t&&t(),i},deleteProperty(e,r){const n=Reflect.deleteProperty(e,r);return t&&t(),n}})),this.init&&this.init(),this.watchProps=Object.keys(this.__state),this.__attributesToState(),this.document=this.useShadowDOM?this.attachShadow({mode:"open"}):this}__attributesToState(){Object.assign(this.state,Array.from(this.attributes).reduce((t,e)=>Object.assign(t,{[e.name]:e.value}),{}))}__update(){this.isConnected&&this.document&&this.render()}get vdom(){return({state:t})=>""}get vstyle(){return({state:t})=>""}setAttribute(t,e){super.setAttribute(t,e),this.watchProps.includes(t)&&(this.state[t]=e)}removeAttribute(t){super.removeAttribute(t),this.watchProps.includes(t)&&t in this.state&&delete this.state[t]}connectedCallback(){this.connected&&this.connected(),this.render()}disconnectedCallback(){this.disconnected&&this.disconnected()}set state(t){Object.assign(this.__state,t)}get state(){return this.__state}render(){return M(O("root",{},[this.vdom({state:this.__state}),this.vstyle({state:this.__state})]),this.document)}}export{j as Component,O as h,M as render};
